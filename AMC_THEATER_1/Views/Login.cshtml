<!--@{
    ViewBag.Title = "Login";
    ViewBag.ShowBasicNavbar = true; // Show only the basic navbar
    ViewBag.ShowNavbar = true;
    ViewBag.ShowSideBar = false;
    ViewBag.Login = true;
}

<div class="d-flex align-items-center justify-content-center mt-5">
    <div class="col-md-5 mt-5">
        <div class="card mt-5">
            <div class="card-header text-center bg-primary text-white">
                <h4>Login</h4>
            </div>
            <div class="card-body">
                <form id="loginForm">-->
<!-- Phone Number Input -->
<!--<div class="mb-3">
    <label for="phoneNumber" class="form-label fw-bold">Phone Number :</label>
    <input type="text" class="form-control" id="phoneNumber" placeholder="Enter your phone number" required>
    <small id="phoneError" class="text-danger" style="display: none;">Please enter a valid phone number.</small>
</div>-->
<!-- Captcha Section -->
<!--<div class="mb-3">
                        <div class="d-flex align-items-center">
                            <canvas id="captchaCanvas" width="200" height="50" class="border rounded mt-3 bg-white  me-2"></canvas>
                            <button type="button" id="refreshCaptcha" class="btn btn-secondary mt-3 d-flex align-items-center">
                                <i class="fas fa-sync-alt"></i>
                            </button>
                        </div>
                        <label for="captchaInput" class="form-label mt-4 fw-bold">Enter Captcha :</label>

                        <input type="text" class="form-control mt-1" id="captchaInput" placeholder="Enter captcha" required>
                        <small id="captchaError" class="text-danger d-none">Invalid Captcha!</small>
                    </div>





                    <button type="button" id="getOtpButton" class="btn btn-primary w-100" onclick="showOtpField()">Get OTP</button>

                    <div id="otpField" class="mb-3 P-3 mt-3" style="display: none;">
                        <label for="otp" class="form-label">OTP</label>
                        <input type="text" class="form-control" id="otp" placeholder="Enter OTP" required>
                    </div>


                    <button type="submit" id="loginButton" class="btn btn-primary w-100" style="display: none;">Login</button>


            </div>
            </form>
        </div>
    </div>
</div>
</div>

<script>
let currentCaptcha = "";

// Function to generate the captcha
function generateCaptcha() {
    const chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";
    let captcha = "";
    for (let i = 0; i < 5; i++) {
        captcha += chars.charAt(Math.floor(Math.random() * chars.length));
    }
    currentCaptcha = captcha;

    // Draw the captcha on the canvas
    const canvas = document.getElementById('captchaCanvas');
    const ctx = canvas.getContext('2d');
    ctx.clearRect(0, 0, canvas.width, canvas.height); // Clear the canvas

    // Set custom font for the captcha text
    ctx.font = '30px Arial, sans-serif';  // Use a clean font
    ctx.fillStyle = '#000';  // Set the text color
    ctx.textAlign = 'center';
    ctx.textBaseline = 'middle';
    ctx.fillText(captcha, canvas.width / 2, canvas.height / 2); // Draw the captcha text

    document.getElementById("captchaError").style.display = "none";  // Hide error on refresh
}

// Event listener for refreshing the captcha
document.getElementById('refreshCaptcha').addEventListener('click', function () {
    generateCaptcha();
});

// Show OTP field after successful captcha and phone number validation
function showOtpField() {
    const enteredCaptcha = document.getElementById("captchaInput").value;
    const phoneNumber = document.getElementById("phoneNumber").value;

    // Validate phone number format
    if (!validatePhoneNumber(phoneNumber)) {
        document.getElementById("phoneError").style.display = "inline";
        return;
    } else {
        document.getElementById("phoneError").style.display = "none";
    }

    // Check if the entered captcha matches the generated one
    if (enteredCaptcha !== currentCaptcha) {
        document.getElementById("captchaError").style.display = "inline";  // Show error message
        return;
    } else {
        document.getElementById("captchaError").style.display = "none";  // Hide error message
    }

    // Show OTP input field after validation
    document.getElementById("otpField").style.display = "block";
    document.getElementById("getOtpButton").style.display = "none";
    document.getElementById("loginButton").style.display = "block";
}

// Validate phone number format (10-digit)
function validatePhoneNumber(phoneNumber) {
    const phoneRegex = /^[0-9]{10}$/;  // Validates a 10-digit phone number
    return phoneRegex.test(phoneNumber);
}

// Trigger captcha generation when the page loads
window.onload = generateCaptcha;

// Handle form submission
document.getElementById("loginForm").addEventListener("submit", function (e) {
    e.preventDefault();  // Prevent form from submitting by default

    const enteredCaptcha = document.getElementById("captchaInput").value;
    const actualCaptcha = currentCaptcha; // Use the currentCaptcha for comparison

    // If captcha is incorrect, show error and prevent form submission
    if (enteredCaptcha !== actualCaptcha) {
        document.getElementById("captchaError").style.display = "inline";  // Show error message
        return;
    } else {
        document.getElementById("captchaError").style.display = "none";  // Hide error message
    }

    // If all validations pass, proceed to the next page
    window.location.href = '@Url.Action("SecondPage", "Home")';  // Redirect to the SecondPage
    });

</script>-->

@{
    ViewBag.Title = "Login";
    ViewBag.ShowBasicNavbar = true; // Show only the basic navbar
    ViewBag.ShowNavbar = true;
    ViewBag.ShowSideBar = false;
    ViewBag.Login = true;
}

<div class="d-flex align-items-center justify-content-center mt-5">
    <div class="col-md-5 mt-5">
        <div class="card mt-5 shadow-lg">
            <div class="card-header text-center bg-primary text-white">
                <h4>Login</h4>
            </div>
            <div class="card-body">
                <form id="loginForm">
                    <!-- Phone Number Input -->
                    <div class="mb-3">
                        <label for="phoneNumber" class="form-label fw-bold">Phone Number :</label>
                        <input type="text" class="form-control" id="phoneNumber" placeholder="Enter your phone number" required>
                        <small id="phoneError" class="text-danger d-none">Please enter a valid phone number.</small>
                    </div>

                    <!-- Captcha Section -->
                    <div class="mb-3">
                        <div class="d-flex align-items-center">
                            <canvas id="captchaCanvas" width="200" height="50" class="border rounded mt-3 bg-white me-2"></canvas>
                            <button type="button" id="refreshCaptcha" class="btn btn-secondary mt-3 d-flex align-items-center">
                                <i class="fas fa-sync-alt"></i>
                            </button>
                        </div>
                        <label for="captchaInput" class="form-label mt-4 fw-bold">Enter Captcha :</label>
                        <input type="text" class="form-control mt-1" id="captchaInput" placeholder="Enter captcha" required>
                        <small id="captchaError" class="text-danger d-none">Invalid Captcha!</small>
                    </div>

                    <!-- OTP Button -->
                    <button type="button" id="getOtpButton" class="btn btn-primary w-100" onclick="showOtpField()">Get OTP</button>

                    <!-- OTP Input Field -->
                    <div id="otpField" class="mb-3 p-3 mt-3 border rounded bg-light d-none">
                        <label for="otp" class="form-label fw-bold">OTP</label>
                        <input type="text" class="form-control" id="otp" placeholder="Enter OTP" required>
                    </div>

                    <!-- Login Button -->
                    <button type="submit" id="loginButton" class="btn btn-primary w-100 d-none">Login</button>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
    let currentCaptcha = "";

    function generateCaptcha() {
        const chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";
        let captcha = "";
        for (let i = 0; i < 5; i++) {
            captcha += chars.charAt(Math.floor(Math.random() * chars.length));
        }
        currentCaptcha = captcha;

        // Draw captcha on canvas
        const canvas = document.getElementById('captchaCanvas');
        const ctx = canvas.getContext('2d');
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.font = '30px Roboto, sans-serif';
        ctx.fillStyle = '#000';
        ctx.textAlign = 'center';
        ctx.textBaseline = 'middle';
        ctx.fillText(captcha, canvas.width / 2, canvas.height / 2);

        // Hide the captcha error on refresh
        document.getElementById("captchaError").classList.add("d-none");
    }

    document.getElementById('refreshCaptcha').addEventListener('click', function() {
        generateCaptcha();
    });

    function showOtpField() {
        const enteredCaptcha = document.getElementById("captchaInput").value;
        const phoneNumber = document.getElementById("phoneNumber").value;

        // Validate phone number
        if (!validatePhoneNumber(phoneNumber)) {
            document.getElementById("phoneError").classList.remove("d-none");
            return;
        } else {
            document.getElementById("phoneError").classList.add("d-none");
        }

        // Validate CAPTCHA
        if (enteredCaptcha !== currentCaptcha) {
            document.getElementById("captchaError").classList.remove("d-none");  // Show captcha error
            return;
        } else {
            document.getElementById("captchaError").classList.add("d-none");  // Hide captcha error
        }

        // Show OTP field and login button
        document.getElementById("otpField").classList.remove("d-none");
        document.getElementById("getOtpButton").classList.add("d-none");
        document.getElementById("loginButton").classList.remove("d-none");
    }

    function validatePhoneNumber(phoneNumber) {
        return /^[0-9]{10}$/.test(phoneNumber);
    }

    document.getElementById("loginForm").addEventListener("submit", function (e) {
        e.preventDefault();

        const enteredCaptcha = document.getElementById("captchaInput").value;

        // Validate phone number
        if (!validatePhoneNumber(document.getElementById("phoneNumber").value)) {
            document.getElementById("phoneError").classList.remove("d-none");
            return;
        } else {
            document.getElementById("phoneError").classList.add("d-none");
        }

        // Validate CAPTCHA again before submitting
        if (enteredCaptcha !== currentCaptcha) {
            document.getElementById("captchaError").classList.remove("d-none");  // Show error message
            return;
        } else {
            document.getElementById("captchaError").classList.add("d-none");  // Hide error message
        }

        // Proceed to next page if validation passes
        window.location.href = '@Url.Action("SecondPage", "Home")';
    });

    window.onload = generateCaptcha;
</script>
